<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨çƒæ–°å† ç–«æƒ…æ•°æ®åˆ†æç»Ÿè®¡ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.css">
    <link rel="stylesheet" href="/static/css/style.css">

    <style>
        .card {
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
    </style>
</head>

<body>

<header class="header py-3">
    <div class="container">
        <h1 class="text-center mb-0">å…¨çƒæ–°å† ç–«æƒ…æ•°æ®åˆ†æç»Ÿè®¡ç³»ç»Ÿ</h1>
    </div>
</header>

<!-- å¯¼èˆªèœå• -->
{% include 'navbar.html' %}

<div class="container-fluid px-4 mt-3">
    <!-- ğŸŸ¦ å›½å®¶é€‰æ‹© -->
    <div class="card">
        <h4>è¯·é€‰æ‹©å›½å®¶æŸ¥çœ‹ç—…ä¾‹å¢é•¿è¶‹åŠ¿</h4>
        <select id="trend_selector" onchange="onTrendChange()">
            <option value="GLOBAL">å…¨çƒ</option>
            <option value="CN">ä¸­å›½</option>
        </select>
    </div>

    <!-- ğŸ“ˆ å¢é•¿è¶‹åŠ¿å›¾ -->
    <div class="card">
        <h4 id="trend_title">ç—…ä¾‹å¢é•¿è¶‹åŠ¿</h4>
        <canvas id="trendChart" height="100"></canvas>
    </div>

    <!-- ğŸŒ¡ Rtè¶‹åŠ¿ -->
    <div class="card">
        <h4>æœ‰æ•ˆä¼ æ’­æ•° Rt</h4>
        <canvas id="rtChart" height="100"></canvas>
    </div>

    <!-- âš° ç—…æ­»ç‡ -->
    <div class="card">
        <h4>ç–«æƒ…ä¸¥é‡ç¨‹åº¦ - ç—…æ­»ç‡</h4>
        <canvas id="cfrChart" height="100"></canvas>
    </div>
</div>
<script>
    let trendChart = null;
    let rtChart = null;
    let cfrChart = null;

    function loadGrowthTrend(code) {
        const url = code === 'CN'
                ? '/api/china/growth-trend'
                : '/api/global/growth-trend';

        fetch(url)
                .then(res => res.json())
                .then(data => {
                    const labels = data.dates;
                    const rates = data.rates.map(r => (r * 100).toFixed(2));

                    if (trendChart) trendChart.destroy();
                    trendChart = new Chart(document.getElementById('trendChart'), {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: `${code === 'CN' ? 'ä¸­å›½' : 'å…¨çƒ'}å¢é•¿ç‡ (%)`,
                                data: rates,
                                borderColor: code === 'CN' ? '#2980b9' : '#e67e22',
                                backgroundColor: code === 'CN' ? 'rgba(41,128,185,0.2)' : 'rgba(230,126,34,0.2)',
                                fill: true,
                                tension: 0.3
                            }]
                        }
                    });

                    document.getElementById('trend_title').innerText =
                            code === 'CN' ? 'ä¸­å›½ç—…ä¾‹å¢é•¿è¶‹åŠ¿' : 'å…¨çƒç—…ä¾‹å¢é•¿è¶‹åŠ¿';
                });
    }

    function loadRtChart(code = 'GLOBAL') {
        const url = code === 'CN' ? '/api/china/rt' : '/api/global/rt';

        fetch(url)
                .then(res => res.json())
                .then(data => {
                    const labels = data.dates;
                    const rtValues = data.rt_values;

                    if (rtChart) rtChart.destroy();
                    rtChart = new Chart(document.getElementById('rtChart'), {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Rt æœ‰æ•ˆä¼ æ’­æ•°',
                                data: rtValues,
                                borderColor: '#2ecc71',
                                backgroundColor: 'rgba(46,204,113,0.2)',
                                fill: true,
                                tension: 0.3
                            }]
                        }
                    });
                });
    }

    function loadCfrChart(code = 'GLOBAL') {
        const url = code === 'CN' ? '/api/china/cfr' : '/api/global/cfr';

        fetch(url)
                .then(res => res.json())
                .then(data => {
                    if (cfrChart) cfrChart.destroy();
                    cfrChart = new Chart(document.getElementById('cfrChart'), {
                        type: 'bar',
                        data: {
                            labels: data.dates,
                            datasets: [{
                                label: 'ç—…æ­»ç‡ (%)',
                                data: data.cfr_values,
                                backgroundColor: 'rgba(231, 76, 60, 0.5)'
                            }]
                        }
                    });
                });
    }

    function onTrendChange() {
        const selected = document.getElementById('trend_selector').value;
        loadGrowthTrend(selected);
        loadRtChart(selected);
        loadCfrChart(selected);
    }

    window.onload = () => {
        const defaultCountry = 'GLOBAL';
        loadGrowthTrend(defaultCountry);
        loadRtChart(defaultCountry);
        loadCfrChart(defaultCountry);
    };
</script>

{% include 'footer.html' %}

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
<script src="{{ url_for('static', filename='js/main.js') }}"></script>

</body>
</html>